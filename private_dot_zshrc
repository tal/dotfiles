eval "$(/opt/homebrew/bin/brew shellenv)"

if [[ -n $GHOSTTY_RESOURCES_DIR ]]; then
  source "$GHOSTTY_RESOURCES_DIR"/shell-integration/zsh/ghostty-integration
fi

eval "$(starship init zsh)"

# Configure zsh-autocomplete
zstyle ':autocomplete:*complete*:*' insert-unambiguous yes  # Only insert the unambiguous part first
[ -f /opt/homebrew/share/zsh-autocomplete/zsh-autocomplete.plugin.zsh ] && source /opt/homebrew/share/zsh-autocomplete/zsh-autocomplete.plugin.zsh
# Override Tab binding AFTER plugin loads â€” use menu-select to show and cycle through matches
bindkey '^I' menu-select
bindkey "$terminfo[kcbt]" menu-select
# Inside the menu: Tab cycles forward, Shift+Tab cycles backward (instead of arrow-key navigation)
bindkey -M menuselect '^I' menu-complete
bindkey -M menuselect "$terminfo[kcbt]" reverse-menu-complete
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
[ -f ~/.letta-code/env ] && source ~/.letta-code/env

source <(fzf --zsh)
eval "$(zoxide init zsh)"

export PATH="$PATH:$HOME/.config/bin"

# Ripgrep configuration
export RIPGREP_CONFIG_PATH="$HOME/.config/ripgrep/config"

# dnscontrol shell completion
command -v dnscontrol >/dev/null 2>&1 && eval "$(dnscontrol shell-completion zsh)"

# bun completions
[ -s "/Users/tal/.bun/_bun" ] && source "/Users/tal/.bun/_bun"

# bun
export BUN_INSTALL="$HOME/.bun"
export PATH="$BUN_INSTALL/bin:$PATH"

# PATH=~/.console-ninja/.bin:$PATH

# datadog
[ -s ~/.zshrc.dd ] &&  source ~/.zshrc.dd

# dre-streams-jvm shortcuts
if [ -d "${HOME}/dd/dre-streams-jvm" ]; then
    source ${HOME}/dd/dre-streams-jvm/scripts/k8s-shortcuts
    source ${HOME}/dd/dre-streams-jvm/scripts/fzf-functions
    source ${HOME}/dd/dre-streams-jvm/scripts/helpers.sh
fi

# dre shortcuts
if [ -d "${HOME}/dd/dre" ]; then
    source ${HOME}/dd/dre/scripts/k8s_aliases.sh
    source ${HOME}/dd/dre/scripts/kafka.sh
fi

# yarn switch
[ -f "$HOME/.yarn/switch/env" ] && source "$HOME/.yarn/switch/env"

# Google Cloud SDK
[ -f "/opt/homebrew/share/google-cloud-sdk/path.zsh.inc" ] && source "/opt/homebrew/share/google-cloud-sdk/path.zsh.inc"

# Load completion system
autoload -Uz compinit
compinit

# Cache completion to speed things up
zstyle ':completion:*' use-cache on
zstyle ':completion:*' cache-path ~/.zsh/cache

# Fuzzy matching of completions
zstyle ':completion:*' completer _complete _match _approximate
zstyle ':completion:*:match:*' original only
zstyle ':completion:*:approximate:*' max-errors 1 numeric

# Case-insensitive completion
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'

# List completions and cycle through them (don't auto-select first)
zstyle ':completion:*' menu select
setopt AUTO_LIST           # List choices on ambiguous completion
setopt LIST_AMBIGUOUS      # Show list immediately when ambiguous
unsetopt MENU_COMPLETE     # Don't insert first match immediately

# Format completion list with descriptions and group headers
zstyle ':completion:*' list-colors ''
zstyle ':completion:*:descriptions' format '%F{green}-- %d --%f'
zstyle ':completion:*:messages' format '%F{yellow}-- %d --%f'
zstyle ':completion:*:warnings' format '%F{red}-- no matches found --%f'

# Group completions by type
zstyle ':completion:*' group-name ''

# Load custom zsh config files (aliases, functions, etc.)
if [ -d "$HOME/.config/zsh" ]; then
    for config_file in "$HOME/.config/zsh"/*.zsh; do
        [ -r "$config_file" ] && source "$config_file"
    done
fi

# Claude
export PATH="$HOME/.claude/local:$PATH"

command -v dd-gitsign >/dev/null 2>&1 && eval "$(dd-gitsign load-key)"

#THIS MUST BE AT THE END OF THE FILE FOR SDKMAN TO WORK!!!
export SDKMAN_DIR="$HOME/.sdkman"
[[ -s "$HOME/.sdkman/bin/sdkman-init.sh" ]] && source "$HOME/.sdkman/bin/sdkman-init.sh"

# Added by Craft Agent installer
export PATH="$HOME/.local/bin:$PATH"
